rules:
  - id: php-weak-password-hash
    patterns:
      - pattern-either:
          - pattern: |
              md5($password)
          - pattern: |
              sha1($password)
          - pattern: |
              crypt($password)
          - pattern: |
              hash('md5', $password)
          - pattern: |
              hash('sha1', $password)
    pattern-not:
      - pattern: |
          password_hash($password, PASSWORD_DEFAULT)
    message: "Слабое хеширование паролей: используйте password_hash() с PASSWORD_DEFAULT вместо md5/sha1."
    languages: [php]
    severity: ERROR
    metadata:
      cwe: "CWE-916: Use of Password Hash With Insufficient Computational Effort"
      owasp: "A02:2021 - Cryptographic Failures"