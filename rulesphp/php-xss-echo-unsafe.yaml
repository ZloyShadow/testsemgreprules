rules:
  - id: php-xss-echo-unsafe
    patterns:
      - pattern-either:
          - pattern: |
              echo $user_input;
          - pattern: |
              print $user_input;
          - pattern: |
              <?= $user_input ?>
    pattern-not:
      - pattern: |
          echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');
      - pattern: |
          echo htmlentities($user_input, ENT_QUOTES, 'UTF-8');
    message: "XSS уязвимость: пользовательский ввод выводится без экранирования. Используйте htmlspecialchars() или htmlentities()."
    languages: [php]
    severity: ERROR
    metadata:
      cwe: "CWE-79: Cross-Site Scripting"
      owasp: "A03:2021 - Injection"