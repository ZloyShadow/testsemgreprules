rules:
  - id: insecure-password-storage-plaintext
    patterns:
      - pattern: |
          INSERT INTO Users (username, password)
          VALUES ($USERNAME, $PASSWORD)
    message: "Антипаттерн 'Незащищенные пароли': пароли хранятся в открытом виде. Всегда хешируйте пароли."
    languages: [sql]
    severity: ERROR

  - id: weak-password-hash-md5
    patterns:
      - pattern-either:
          - pattern: |
              INSERT INTO Users (username, password_hash)
              VALUES ($USERNAME, MD5($PASSWORD))
          - pattern: |
              UPDATE Users
              SET password_hash = MD5($PASSWORD)
              WHERE username = $USERNAME
    message: "Слабое хеширование паролей: MD5 небезопасен для хранения паролей. Используйте bcrypt, argon2, или PBKDF2."
    languages: [sql]
    severity: ERROR

  - id: weak-password-hash-sha1
    patterns:
      - pattern-either:
          - pattern: |
              INSERT INTO Users (username, password_hash)
              VALUES ($USERNAME, SHA1($PASSWORD))
          - pattern: |
              UPDATE Users
              SET password_hash = SHA1($PASSWORD)
              WHERE username = $USERNAME
    message: "Слабое хеширование паролей: SHA1 небезопасен для хранения паролей. Используйте bcrypt, argon2, или PBKDF2."
    languages: [sql]
    severity: ERROR